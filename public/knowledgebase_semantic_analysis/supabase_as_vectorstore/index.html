<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/langchain_project_book/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=langchain_project_book/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.131.0">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="We will introduce Supabase as a vector store and walk through the process of storing various embeddings in Supabase Vector, a combination of PostgreSQL and pgVector, aimed at facilitating semantic search.
Supabase, an open-source alternative to Firebase, is constructed atop PostgreSQL, a robust SQL database suitable for production environments. Given that Supabase Vector is built on pgVector, it allows for the storage of embeddings alongside other application data within the same database.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Supabase as VectorStore :: LangChain AI">
    <meta name="twitter:description" content="We will introduce Supabase as a vector store and walk through the process of storing various embeddings in Supabase Vector, a combination of PostgreSQL and pgVector, aimed at facilitating semantic search.
Supabase, an open-source alternative to Firebase, is constructed atop PostgreSQL, a robust SQL database suitable for production environments. Given that Supabase Vector is built on pgVector, it allows for the storage of embeddings alongside other application data within the same database.">
    <meta property="og:url" content="http://localhost:1313/langchain_project_book/knowledgebase_semantic_analysis/supabase_as_vectorstore/index.html">
    <meta property="og:site_name" content="LangChain AI">
    <meta property="og:title" content="Supabase as VectorStore :: LangChain AI">
    <meta property="og:description" content="We will introduce Supabase as a vector store and walk through the process of storing various embeddings in Supabase Vector, a combination of PostgreSQL and pgVector, aimed at facilitating semantic search.
Supabase, an open-source alternative to Firebase, is constructed atop PostgreSQL, a robust SQL database suitable for production environments. Given that Supabase Vector is built on pgVector, it allows for the storage of embeddings alongside other application data within the same database.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="KnowledgeBase Semantic Analysis">
    <meta property="article:published_time" content="2024-10-28T22:26:09+08:00">
    <meta property="article:modified_time" content="2024-10-28T22:26:09+08:00">
    <meta itemprop="name" content="Supabase as VectorStore :: LangChain AI">
    <meta itemprop="description" content="We will introduce Supabase as a vector store and walk through the process of storing various embeddings in Supabase Vector, a combination of PostgreSQL and pgVector, aimed at facilitating semantic search.
Supabase, an open-source alternative to Firebase, is constructed atop PostgreSQL, a robust SQL database suitable for production environments. Given that Supabase Vector is built on pgVector, it allows for the storage of embeddings alongside other application data within the same database.">
    <meta itemprop="datePublished" content="2024-10-28T22:26:09+08:00">
    <meta itemprop="dateModified" content="2024-10-28T22:26:09+08:00">
    <meta itemprop="wordCount" content="1202">
    <title>Supabase as VectorStore :: LangChain AI</title>
    <link href="/langchain_project_book/css/auto-complete/auto-complete.min.css?1755623690" rel="stylesheet">
    <script src="/langchain_project_book/js/auto-complete/auto-complete.min.js?1755623690" defer></script>
    <script src="/langchain_project_book/js/search-lunr.js?1755623690" defer></script>
    <script src="/langchain_project_book/js/search.js?1755623690" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/langchain_project_book/searchindex.en.js?1755623690";
    </script>
    <script src="/langchain_project_book/js/lunr/lunr.min.js?1755623690" defer></script>
    <script src="/langchain_project_book/js/lunr/lunr.stemmer.support.min.js?1755623690" defer></script>
    <script src="/langchain_project_book/js/lunr/lunr.multi.min.js?1755623690" defer></script>
    <script src="/langchain_project_book/js/lunr/lunr.en.min.js?1755623690" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/langchain_project_book/fonts/fontawesome/css/fontawesome-all.min.css?1755623690" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/langchain_project_book/fonts/fontawesome/css/fontawesome-all.min.css?1755623690" rel="stylesheet"></noscript>
    <link href="/langchain_project_book/css/perfect-scrollbar/perfect-scrollbar.min.css?1755623690" rel="stylesheet">
    <link href="/langchain_project_book/css/theme.css?1755623690" rel="stylesheet">
    <link href="/langchain_project_book/css/format-html.css?1755623690" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/knowledgebase_semantic_analysis\/supabase_as_vectorstore\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313\/langchain_project_book';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/langchain_project_book/knowledgebase_semantic_analysis/supabase_as_vectorstore/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/langchain_project_book/index.html"><span itemprop="name">LangChain Project Handbook</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/langchain_project_book/knowledgebase_semantic_analysis/index.html"><span itemprop="name">KnowledgeBase Semantic Analysis</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Supabase as VectorStore</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/langchain_project_book/knowledgebase_semantic_analysis/select_embed_model/index.html" title="Selecting the Embedding Model (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/langchain_project_book/knowledgebase_semantic_analysis/config_llm_with_gemma/index.html" title="Configuring LLM with Google Gemma (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable knowledgebase_semantic_analysis" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="supabase-as-vectorstore">Supabase as VectorStore</h1>

<p>We will introduce Supabase as a vector store and walk through the process of storing various embeddings in Supabase Vector, a combination of PostgreSQL and <code>pgVector</code>, aimed at facilitating semantic search.</p>
<p>Supabase, an open-source alternative to Firebase, is constructed atop PostgreSQL, a robust SQL database suitable for production environments. Given that Supabase Vector is built on <code>pgVector</code>, it allows for the storage of embeddings alongside other application data within the same database. This integration with <code>pgvector</code>&rsquo;s indexing algorithms ensures that vector searches remain efficient even at large scales.</p>
<p>Supabase further enhances app development by offering a range of services and tools, including an auto-generated REST API, to streamline the storage and querying of embeddings within PostgreSQL. Additionally, Supabase provides a user-friendly interface that simplifies the interaction with SQL editors and database components, making it easier to manage and manipulate data.</p>
<p>Our goal in this business case is to utilize Supabase as a vector store, focusing on the following objectives:</p>
<ul>
<li>Leverage the open-source nature of PostgreSQL with the <code>vector</code> extension for efficient vector storage.</li>
<li>Manage both data and extensions seamlessly within the Supabase UI, ensuring ease of use and control.</li>
<li>Ensure vector data is stored persistently, maintaining integrity and availability for future use.</li>
<li>Integrate with LangChain.</li>
</ul>
<h4 id="installing-self-hosting-with-docker">Installing Self-Hosting with Docker</h4>
<p>There are multiple methods to install Supabase, and we will focus on self-hosting with Docker. Alternatively, you can opt for the Supabase online service, eliminating the need to manage its infrastructure yourself.</p>
<p>One of the advantages of self-hosting Supabase is the assurance of persistent local storage for all data, ensuring that queries and responses remain within your private network for enhanced security.</p>
<p>Let&rsquo;s assume that you already have had <code>git</code> and <code>docker</code> installed and configured properly.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># Get the code</span>
</span></span><span style="display:flex;"><span>git clone --depth <span style="color:#ae81ff">1</span> https://github.com/supabase/supabase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Go to the docker folder</span>
</span></span><span style="display:flex;"><span>cd supabase/docker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Copy the fake env vars</span>
</span></span><span style="display:flex;"><span>cp .env.example .env
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pull the latest images</span>
</span></span><span style="display:flex;"><span>docker compose pull
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Start the services (in detached mode)</span>
</span></span><span style="display:flex;"><span>docker compose up -d</span></span></code></pre></div>
<p>It may take a while to download the images within your Docker environment. When it&rsquo;s done, the output looks like this.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Running 12/13
</span></span><span style="display:flex;"><span> ⠴ Network supabase_default                  Created           19.6s
</span></span><span style="display:flex;"><span> ✔ Container supabase-imgproxy               Started            1.1s
</span></span><span style="display:flex;"><span> ✔ Container supabase-vector                 Healthy            6.4s
</span></span><span style="display:flex;"><span> ✔ Container supabase-db                     Healthy           12.1s
</span></span><span style="display:flex;"><span> ✔ Container supabase-analytics              Healthy           17.8s
</span></span><span style="display:flex;"><span> ✔ Container supabase-auth                   Started           18.7s
</span></span><span style="display:flex;"><span> ✔ Container supabase-meta                   Started           18.5s
</span></span><span style="display:flex;"><span> ✔ Container supabase-edge-functions         Started           18.7s
</span></span><span style="display:flex;"><span> ✔ Container realtime-dev.supabase-realtime  Started           18.5s
</span></span><span style="display:flex;"><span> ✔ Container supabase-studio                 Started           18.9s
</span></span><span style="display:flex;"><span> ✔ Container supabase-kong                   Started           18.5s
</span></span><span style="display:flex;"><span> ✔ Container supabase-rest                   Started           18.1s
</span></span><span style="display:flex;"><span> ✔ Container supabase-storage                Started           18.9s</span></span></code></pre></div>
<p>For more information about self-hosting install, here&rsquo;s the official documentation</p>
<blockquote>
<p>Reference &gt; <a href="https://supabase.com/docs/guides/self-hosting/docker#accessing-supabase-dashboard" rel="external" target="_blank">https://supabase.com/docs/guides/self-hosting/docker#accessing-supabase-dashboard</a></p>
</blockquote>
<h4 id="configuring-vector-for-embedding">Configuring Vector for Embedding</h4>
<p>It&rsquo;s important to note that when using the <code>sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2</code> embedding model, the dimensionality of the embedding vector is <code>384</code>. This detail must be considered when changing the embedding model, as it affects the configuration of the vector database with Supabase.</p>
<p>After all Docker containers have been fully created and launched, you can access the Supabase portal at http://127.0.0.1:8000/. The default user ID and password can be found in <code>supabase/docker/.env</code>.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>DASHBOARD_USERNAME<span style="color:#f92672">=</span>supabase
</span></span><span style="display:flex;"><span>DASHBOARD_PASSWORD<span style="color:#f92672">=</span>this_password_is_insecure_and_should_be_updated</span></span></code></pre></div>
<p>It is strongly recommended to change these default values for security reasons, especially if running in a production environment.</p>
<p>Please be aware that if you modify these values in the <code>supabase/docker/.env</code> file, you must restart all the containers to apply the updates. This can be done using the following commands:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd supabase/docker
</span></span><span style="display:flex;"><span>docker compose down
</span></span><span style="display:flex;"><span>docker compose up -d</span></span></code></pre></div>
<blockquote>
<p>Security Warning: The IP address on port 8000 is intended to be accessible from anywhere on the network. Therefore, it is not advisable to expose this directly to the internet without first setting up a proper firewall configuration.</p>
</blockquote>
<p>After you successfully log into the portal, you can see</p>
<p><a href="#R-image-b09c0dd4f2e86b2e8b5873b1b6184e28" class="lightbox-link"><img class="lazy lightbox figure-image" loading="lazy" src="/langchain_project_book/images/2024-05-01-21-22-34.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b09c0dd4f2e86b2e8b5873b1b6184e28"><img class="lazy lightbox lightbox-image" loading="lazy" src="/langchain_project_book/images/2024-05-01-21-22-34.png"></a></p>
<p>Figure 6.2 Supabase Dashboard</p>
<!-- raw HTML omitted -->
<p>Select <code>SQL Editor</code> from navigation panel, copy and paste the following SQL into <code>SQL Query</code>, then click <code>Run</code>. The SQL code creates an extension of <code>vector</code> and a table called <code>documents</code> which will be used to store the embedded documents.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Enable the pgvector extension to work with embedding vectors
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> extension <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">exists</span> vector;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Create a table to store your documents
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span>
</span></span><span style="display:flex;"><span>  documents (
</span></span><span style="display:flex;"><span>    id uuid <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>    content text, <span style="color:#75715e">-- corresponds to Document.pageContent
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    metadata jsonb, <span style="color:#75715e">-- corresponds to Document.metadata
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    embedding vector (<span style="color:#ae81ff">384</span>) <span style="color:#75715e">-- 384 works for Sentence-Transformers embeddings, change if needed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Create a function to search for documents
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">function</span> match_documents (
</span></span><span style="display:flex;"><span>  query_embedding vector (<span style="color:#ae81ff">384</span>),
</span></span><span style="display:flex;"><span>  filter jsonb <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#39;{}&#39;</span>
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">returns</span> <span style="color:#66d9ef">table</span> (
</span></span><span style="display:flex;"><span>  id uuid,
</span></span><span style="display:flex;"><span>  content text,
</span></span><span style="display:flex;"><span>  metadata jsonb,
</span></span><span style="display:flex;"><span>  similarity float
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">language</span> plpgsql <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">$$</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span>variable_conflict use_column
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> query
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>    id,
</span></span><span style="display:flex;"><span>    content,
</span></span><span style="display:flex;"><span>    metadata,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> (documents.embedding <span style="color:#f92672">&lt;=&gt;</span> query_embedding) <span style="color:#66d9ef">as</span> similarity
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">from</span> documents
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">where</span> metadata <span style="color:#f92672">@&gt;</span> filter
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> documents.embedding <span style="color:#f92672">&lt;=&gt;</span> query_embedding;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$$</span>;</span></span></code></pre></div>
<blockquote>
<p>Note: Since we are utilizing the <code>sentence-transformers/paraphrase-multilingual</code> model for embeddings, it is necessary to set the &ldquo;embedding vector&rdquo; value to <code>384</code>.</p>
</blockquote>
<p>If you need to switch to OpenAI&rsquo;s embedding model, you&rsquo;ll have to specify the vector value. Here&rsquo;s an example:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> documents
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">COLUMN</span> embedding <span style="color:#66d9ef">TYPE</span> vector(<span style="color:#ae81ff">1536</span>);</span></span></code></pre></div>
<p>Upon completion of the execution, you will discover a database named &ldquo;documents&rdquo; under &ldquo;Database&rdquo; and an extension named &ldquo;vector&rdquo; located under &ldquo;Extensions.&rdquo;</p>
<p>For detailed documentation of LangChain with Supabase, you may want to check</p>
<blockquote>
<p>Reference &gt; <a href="https://python.langchain.com/docs/integrations/vectorstores/supabase/" rel="external" target="_blank">https://python.langchain.com/docs/integrations/vectorstores/supabase/</a></p>
</blockquote>
<!-- raw HTML omitted -->
<p>On macOS, you may experience an issue where the containers <code>supabase-meta</code> and <code>supabase-studio</code> continuously restart. This problem can be resolved by disabling the &ldquo;Use Virtualization Framework&rdquo; option and changing the file sharing implementation from &ldquo;VirtioFS&rdquo; to &ldquo;gRPC FUSE&rdquo;. This solution applies to Docker Desktop version <code>v4.29.0</code>.</p>
<p>Settings &gt; General &gt; Use Virtualization framework &gt; select &ldquo;gRPC FUSE&rdquo; then un-check &ldquo;Use Virtualization framework&rdquo;</p>
<p><a href="#R-image-8c12e3050ad99e3ef23f6cbf42ada668" class="lightbox-link"><img class="lazy lightbox figure-image" loading="lazy" src="/langchain_project_book/images/2024-05-07-11-29-17.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8c12e3050ad99e3ef23f6cbf42ada668"><img class="lazy lightbox lightbox-image" loading="lazy" src="/langchain_project_book/images/2024-05-07-11-29-17.png"></a></p>
<p>Figure 6.3 Change Virtualization framework for Supabase on macOS</p>
<blockquote>
<p>Reference &gt; <a href="https://github.com/supabase/cli/issues/1724" rel="external" target="_blank">https://github.com/supabase/cli/issues/1724</a></p>
</blockquote>
<h4 id="accessing-the-apis">Accessing the APIs</h4>
<p>Upon completing the Supabase configuration, it&rsquo;s necessary to identify the API service key for LangChain, which will be responsible for managing Supabase as the vector store. This key can be found in the section of <code>ANON_KEY</code>.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd supabase/docker
</span></span><span style="display:flex;"><span>cat .env</span></span></code></pre></div>
<p>The <code>ANON_KEY</code> is API service key.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">############</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Secrets</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">############</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>POSTGRES_PASSWORD<span style="color:#f92672">=</span>your-super-secret-and-long-postgres-password
</span></span><span style="display:flex;"><span>JWT_SECRET<span style="color:#f92672">=</span>your-super-secret-jwt-token-with-at-least-32-characters-long
</span></span><span style="display:flex;"><span>ANON_KEY<span style="color:#f92672">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE
</span></span><span style="display:flex;"><span>SERVICE_ROLE_KEY<span style="color:#f92672">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q
</span></span><span style="display:flex;"><span>DASHBOARD_USERNAME<span style="color:#f92672">=</span>supabase
</span></span><span style="display:flex;"><span>DASHBOARD_PASSWORD<span style="color:#f92672">=</span>this_password_is_insecure_and_should_be_updated</span></span></code></pre></div>
<blockquote>
<p>Security Warning: the API key and password used here are default values without any modifications. For production environments, it&rsquo;s crucial to update all passwords and API keys to enhance security. You can visit the following website to update and modify your keys.</p>
</blockquote>
<p><a href="https://supabase.com/docs/guides/self-hosting/docker#securing-your-services" rel="external" target="_blank">https://supabase.com/docs/guides/self-hosting/docker#securing-your-services</a></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h4 id="inserting-the-embedded-data-into-vectorstore-with-supabasevectorstorefrom_documents">Inserting the Embedded Data into VectorStore with <code>SupabaseVectorStore.from_documents</code></h4>
<p>After establishing the documents table in the database, we proceed to insert the embedded data into it using <code>SupabaseVectorStore.from_documents</code> and define the vector store.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> getpass
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;SUPABASE_URL&#34;</span>] <span style="color:#f92672">=</span> getpass<span style="color:#f92672">.</span>getpass(<span style="color:#e6db74">&#34;Supabase URL: &#34;</span>)
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;SUPABASE_SERVICE_KEY&#34;</span>] <span style="color:#f92672">=</span> getpass<span style="color:#f92672">.</span>getpass(<span style="color:#e6db74">&#34;Supabase Svc Key: &#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain_community.vectorstores <span style="color:#f92672">import</span> SupabaseVectorStore
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> supabase.client <span style="color:#f92672">import</span> Client, create_client
</span></span><span style="display:flex;"><span>supabase_url <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;SUPABASE_URL&#34;</span>)
</span></span><span style="display:flex;"><span>supabase_key <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;SUPABASE_SERVICE_KEY&#34;</span>)
</span></span><span style="display:flex;"><span>supabase_client <span style="color:#f92672">=</span> create_client(supabase_url, supabase_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># create a new collection if it doesn&#39;t exist</span>
</span></span><span style="display:flex;"><span>vectorstore <span style="color:#f92672">=</span> SupabaseVectorStore<span style="color:#f92672">.</span>from_documents(
</span></span><span style="display:flex;"><span>    chunks,
</span></span><span style="display:flex;"><span>    embedding <span style="color:#f92672">=</span> embedding,
</span></span><span style="display:flex;"><span>    client<span style="color:#f92672">=</span>supabase_client,
</span></span><span style="display:flex;"><span>    table_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;documents&#34;</span>,
</span></span><span style="display:flex;"><span>    query_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;match_documents&#34;</span>,
</span></span><span style="display:flex;"><span>    chunk_size<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>retriever <span style="color:#f92672">=</span> vectorstore<span style="color:#f92672">.</span>as_retriever()</span></span></code></pre></div>
<p>Once the embedded data has been loaded, you can execute queries against the vector store using the <code>SupabaseVectorStore</code> function, instead of <code>SupabaseVectorStore.from_documents</code>, without the need to reload the data into the vector store. We&rsquo;ll see the code below.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># query an existing collection</span>
</span></span><span style="display:flex;"><span>vectorstore <span style="color:#f92672">=</span> SupabaseVectorStore(
</span></span><span style="display:flex;"><span>    embedding <span style="color:#f92672">=</span> embedding,
</span></span><span style="display:flex;"><span>    client <span style="color:#f92672">=</span> supabase_client,
</span></span><span style="display:flex;"><span>    table_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;documents&#34;</span>,
</span></span><span style="display:flex;"><span>    query_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;match_documents&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>retriever <span style="color:#f92672">=</span> vectorstore<span style="color:#f92672">.</span>as_retriever()</span></span></code></pre></div>

  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Oct 28, 2024
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/langchain_project_book/index.html">
            <div class="logo-title">LangChain AI</div>
          </a>
        </div>
        <search><form action="/langchain_project_book/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/langchain_project_book/index.html"><a class="padding" href="/langchain_project_book/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/langchain_project_book/preface/index.html"><a class="padding" href="/langchain_project_book/preface/index.html">Preface</a></li>
            <li class="" data-nav-id="/langchain_project_book/fundamentals/index.html"><a class="padding" href="/langchain_project_book/fundamentals/index.html">LangChain Fundamentals</a><ul id="R-subsections-0784c4bcc83cbdf0ace68502ac3215e0" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/langchain_project_book/tools_n_lib/index.html"><a class="padding" href="/langchain_project_book/tools_n_lib/index.html">Tools and Libraries</a><ul id="R-subsections-fec951202c7c0f845b2452661e4af48e" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/langchain_project_book/doc_sum/index.html"><a class="padding" href="/langchain_project_book/doc_sum/index.html">Document Summarization</a><ul id="R-subsections-c75a3cc5095251ebcf3be162192ea6c9" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/langchain_project_book/ticketing_sys/index.html"><a class="padding" href="/langchain_project_book/ticketing_sys/index.html">Ticketing System</a><ul id="R-subsections-3f5863c85ccf3c65e662463e67f08191" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/index.html">KnowledgeBase Semantic Analysis</a><ul id="R-subsections-c498a6349176744d42feaf82a24933fb" class="collapsible-menu">
            <li class="" data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/arch_n_workflow/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/arch_n_workflow/index.html">Architecture and Workflow</a></li>
            <li class="" data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/preparing_data/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/preparing_data/index.html">Preparing Data</a></li>
            <li class="" data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/select_embed_model/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/select_embed_model/index.html">Selecting the Embedding Model</a></li>
            <li class="active " data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/supabase_as_vectorstore/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/supabase_as_vectorstore/index.html">Supabase as VectorStore</a></li>
            <li class="" data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/config_llm_with_gemma/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/config_llm_with_gemma/index.html">Configuring LLM with Google Gemma</a></li>
            <li class="" data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/enable_multiconv_with_history/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/enable_multiconv_with_history/index.html">Enabling Multi-Round Conversations with Chat History</a></li>
            <li class="" data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/complete_code/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/complete_code/index.html">Complete Code</a></li>
            <li class="" data-nav-id="/langchain_project_book/knowledgebase_semantic_analysis/summary/index.html"><a class="padding" href="/langchain_project_book/knowledgebase_semantic_analysis/summary/index.html">Summary</a></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/langchain_project_book/js/clipboard/clipboard.min.js?1755623690" defer></script>
    <script src="/langchain_project_book/js/perfect-scrollbar/perfect-scrollbar.min.js?1755623690" defer></script>
    <script src="/langchain_project_book/js/theme.js?1755623690" defer></script>
  </body>
</html>
